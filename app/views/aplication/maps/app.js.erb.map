{"version":3,"sources":["app.js","material/Material.js","material/MaterialController.js","material/MaterialsController.js","photo/PhotoController.js","photo/PhotoFactory.js","photo/PhotosController.js","photo/PhotosWindowController.js","tag/TagController.js","tag/TagsController.js","video/Video.js","video/VideoController.js","video/VideosController.js"],"names":["console","log","$","click","e","preventDefault","toggleClass","angular","module","config","$routeProvider","$locationProvider","$provide","decorator","taRegisterTool","$modal","$delegate","toolbar","iconclass","action","$deferred","textAngular","this","savedSelection","rangy","saveSelection","modalInstance","open","animation","templateUrl","size","controller","result","then","path","restoreSelection","$editor","wrapSelection","resolve","unshift","when","controllerAs","html5Mode","factory","$resource","update","method","$scope","$routeParams","$location","$log","growl","Material","info","showPhotosWindow","selectedTags","material","file","isNaN","parseFloat","id","get","data","published","Date","tags","deleteMaterial","addSuccessMessage","ttl","setTimeout","addErrorMessage","saveMaterial","rubric","save","materialRubrics","name","value","materialTags","alias","paginate","list","fullList","length","Math","ceil","i","pages","Array","apply","map","slice","changePage","page","tok","from","to","query","after","$rootScope","Photo","checkPhoto","next","prev","photoChanged","choosePhoto","$emit","savePhoto","photo","deletePhoto","$index","splice","$watch","$http","$timeout","Upload","init","clearPhoto","photoFile","imgClass","selectPhoto","progressWidth","width","photoRubrics","$error","upload","url","resp","evt","progressPercentage","parseInt","loaded","total","$modalInstance","closeWindow","dismiss","$on","close","Video","checkVideo","videoChanged","saveVideo","video","deleteVideo","clearVideo","videoRubrics"],"mappings":"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","file":"app.js.erb","sourcesContent":["console.log('Starting app');\r\n\r\n$(\"#menu-toggle\").click(function(e) {\r\n    e.preventDefault();\r\n    $(\"#wrapper\").toggleClass(\"toggled\");\r\n});\r\n\r\nangular.module('admin', [\r\n        'ngRoute',\r\n        'ngSanitize',\r\n        'ngResource',\r\n        'textAngular',\r\n        'ui.bootstrap',\r\n        'ngFileUpload',\r\n        'angular-growl'\r\n    ])\r\n\r\n.config(function($routeProvider, $locationProvider, $provide) {\r\n\r\n    $provide.decorator('taOptions', function(taRegisterTool, $modal, $delegate) {\r\n        // $delegate is the taOptions we are decorating\r\n        // register the tool with textAngular\r\n        $delegate.toolbar = [\r\n            [\r\n                'h1',\r\n                'h2',\r\n                'h3',\r\n                'h4',\r\n                'h5',\r\n                'h6',\r\n                'p',\r\n                'pre',\r\n                'quote'\r\n            ],\r\n            [\r\n                'bold',\r\n                'italics',\r\n                'underline',\r\n                'strikeThrough',\r\n                'ul',\r\n                'ol'\r\n            ],\r\n            [\r\n                'undo',\r\n                'redo',\r\n                'clear'\r\n            ],\r\n            [\r\n                'justifyLeft',\r\n                'justifyCenter',\r\n                'justifyRight',\r\n                'justifyFull',\r\n                'indent',\r\n                'outdent'\r\n            ],\r\n            [\r\n                'insertLink',\r\n                'insertVideo',\r\n                'html'\r\n            ]\r\n        ];\r\n\r\n        taRegisterTool('imageUpload', {\r\n            iconclass: \"fa fa-picture-o\",\r\n            action: function($deferred) {\r\n                var textAngular = this;\r\n                var savedSelection = rangy.saveSelection();\r\n                var modalInstance = $modal.open({\r\n                    animation: true,\r\n                    templateUrl: '/api/photo/overlay.html',\r\n                    size: 'lg',\r\n                    controller: 'PhotosWindowController'\r\n                });\r\n\r\n                modalInstance.result.then(function(path) {\r\n                    rangy.restoreSelection(savedSelection);\r\n                    textAngular.$editor().wrapSelection('insertImage', '/img/photos/' + path);\r\n                    $deferred.resolve();\r\n                });\r\n                return false;\r\n            }\r\n        });\r\n\r\n        // Now add the button to the default toolbar definition\r\n        // Note: It'll be the last button\r\n        $delegate.toolbar[4].unshift('imageUpload');\r\n        return $delegate;\r\n    });\r\n\r\n   $routeProvider\r\n       .when('/', {\r\n           templateUrl: '/api/material/list.html',\r\n           //controller: 'MaterialsController',\r\n           controller: 'MaterialsController',\r\n           controllerAs: 'materials'\r\n       })\r\n       .when('/materials/:rubric', {\r\n           templateUrl: '/api/material/list.html',\r\n           controller: 'MaterialsController',\r\n           //controllerAs: 'materials'\r\n       })\r\n       .when('/materials', {\r\n           templateUrl: '/api/material/list.html',\r\n           controller: 'MaterialsController',\r\n           //controllerAs: 'materials'\r\n       })\r\n       .when('/material/:id', {\r\n           templateUrl: '/api/material/edit.html',\r\n           controller: 'MaterialController',\r\n           //controllerAs: 'material'\r\n       })\r\n       .when('/photos', {\r\n           templateUrl: '/api/photo/list.html',\r\n           controller: 'PhotosController',\r\n           //controllerAs: 'photos'\r\n       })\r\n       .when('/photos/:rubric', {\r\n           templateUrl: '/api/photo/list.html',\r\n           controller: 'PhotosController',\r\n           //controllerAs: 'photo'\r\n       })\r\n       .when('/videos', {\r\n           templateUrl: '/api/video/list.html',\r\n           controller: 'VideosController',\r\n           controllerAs: 'videos'\r\n       })\r\n       .when('/videos/:rubric', {\r\n           templateUrl: '/api/video/list.html',\r\n           controller: 'VideosController',\r\n           controllerAs: 'videos'\r\n       })\r\n       .when('/tags', {\r\n           templateUrl: '/api/tag/list.html',\r\n           controller: 'TagsController',\r\n           controllerAs: 'tags'\r\n       })\r\n       .when('/tags/:id', {\r\n           templateUrl: '/api/tag/edit.html',\r\n           controller: 'TagController',\r\n           controllerAs: 'tag'\r\n       });\r\n\r\n       // use the HTML5 History API\r\n       $locationProvider.html5Mode(true);\r\n });\r\n","angular.module('admin')\r\n    .factory('Material', function($resource) {\r\n        return $resource('/api/material/:id.json', null, {\r\n            update: {\r\n                method: 'PUT'\r\n            }\r\n        });\r\n    });","angular.module('admin')\r\n\r\n    .controller('MaterialController', function($scope, $routeParams, $location, $log, growl, Material) {\r\n        \r\n        $log.info('MaterialController');\r\n\r\n        $scope.showPhotosWindow = false;\r\n        $scope.selectedTags = [];\r\n\r\n        var material = {};\r\n        $scope.file = '';\r\n        //$scope.materialChanged = false;\r\n\r\n        if(!isNaN(parseFloat($routeParams.id))) {\r\n\r\n            material = Material.get({ id: $routeParams.id }, function(data) {\r\n                data.material.published = new Date(data.material.published);\r\n                $scope.selectedTags = data.tags;\r\n                $scope.material = data.material;\r\n            });\r\n        }\r\n\r\n        /*var modalInstance = $modal.open({\r\n            animation: true,\r\n            templateUrl: '/api/photo/overlay.html',\r\n            controller: 'PhotosWindowController',\r\n            size: 'lg'\r\n        });\r\n\r\n        modalInstance.result.then(function (selectedItem) {\r\n            $scope.selected = selectedItem;\r\n        }, function () {\r\n            $log.info('Modal dismissed at: ' + new Date());\r\n        });\r\n        */\r\n        $scope.deleteMaterial = function deleteMaterial() {\r\n            Material.delete({id:$scope.material.id}, function(res) {\r\n                    growl.addSuccessMessage('Материал удалён', {ttl: 2000});\r\n\r\n                    $scope.material.id = null;\r\n                    setTimeout(function() {\r\n                        $location.path('/admin/materials');\r\n                    }, 1000);\r\n                }, function(res) {\r\n                    growl.addErrorMessage('Ошибка при удалении', {ttl: 2000});\r\n                });\r\n\r\n        };\r\n\r\n        $scope.saveMaterial = function saveMaterial() {\r\n\r\n            var material = $scope.material;\r\n            \r\n            if(material.rubric === 'persons') {\r\n\r\n                material.tags = $scope.selectedTags;\r\n            } else {\r\n                $scope.selectedTags = [];\r\n            }\r\n\r\n            if($scope.material.id) {\r\n\r\n                Material.update({id:$scope.material.id}, {material: material},\r\n                    function(material) {\r\n                        material.published = new Date(material.published);\r\n                        $scope.material = material;\r\n                        growl.addSuccessMessage('Материал сохранён', {ttl: 2000});\r\n                    }, function(res) {\r\n                        growl.addErrorMessage('Произошла ошибка', {ttl: 2000});\r\n                    });\r\n            } else {\r\n\r\n                Material.save({material: material}, function(material) {\r\n                    material.published = new Date(material.published);\r\n                    $scope.material = material;\r\n                    $location.path('/material/' + material.id);\r\n                    growl.addSuccessMessage('Материал добавлен', {ttl: 2000});\r\n                }, function(res) {\r\n                    growl.addErrorMessage('Произошла ошибка', {ttl: 2000});\r\n                });\r\n            }\r\n            //$scope.materialChanged = false;\r\n        };\r\n\r\n\r\n/*        $scope.$watch(function() {\r\n            return $scope.material;\r\n        }, checkMaterial, true);\r\n\r\n        function checkMaterial(next, prev) {\r\n            if(next!==prev) {\r\n                $scope.materialChanged = true;\r\n            }\r\n        }*/\r\n\r\n        $scope.materialRubrics = [\r\n            {\r\n                name: 'Персоны',\r\n                value: 'persons'\r\n            },\r\n            {\r\n                name: 'Рецензии',\r\n                value: 'reviews'\r\n            },\r\n            {\r\n                name: 'Путешечтвия',\r\n                value: 'travel'\r\n            },\r\n            {\r\n                name: 'Новости Клуба',\r\n                value: 'news'\r\n            },\r\n            {\r\n                name: 'Стихи',\r\n                value: 'poetry'\r\n            },\r\n            {\r\n                name: 'Песни',\r\n                value: 'songs'\r\n            },\r\n            {\r\n                name: 'Рассказы',\r\n                value: 'stories'\r\n            },\r\n            {\r\n                name: 'Мысли',\r\n                value: 'thoughts'\r\n            }\r\n        ];\r\n\r\n        $scope.materialTags = [\r\n            {\r\n                id: 1,\r\n                name: 'Звёзды',\r\n                alias: 'celebrity'\r\n            },\r\n            {\r\n                id: 2,\r\n                name: 'Актёры',\r\n                alias: 'actors'\r\n            },\r\n            {\r\n                id: 3,\r\n                name: 'Режисёры',\r\n                alias: 'Directors'\r\n            }\r\n        ];\r\n\r\n\r\n\r\n/*        $scope.orightml = '';\r\n        $scope.htmlcontent = $scope.orightml;\r\n        $scope.disabled = false;*/\r\n    });","angular.module('admin')\r\n\r\n    .controller('MaterialsController', function($scope, $routeParams, Material) {\r\n        console.log('MaterialsController');\r\n\r\n        var rubric = $routeParams.rubric;\r\n\r\n        $scope.fullList = [];\r\n\r\n        $scope.pages = [];\r\n\r\n        $scope.changePage = function changePage(page) {\r\n            if(page === 1) {\r\n\r\n                $scope.list = $scope.fullList.slice(0, 11);\r\n            } else {\r\n\r\n                var tok = page * 10,\r\n                    from = tok - 10 + 1,\r\n                    to = tok + 1;\r\n                $scope.list = $scope.fullList.slice(from, to);\r\n            }\r\n        };\r\n\r\n        Material.query({\r\n            rubric: rubric,\r\n            after: 'infinity'\r\n        }, function(list) {\r\n            paginate(list);\r\n        });\r\n\r\n        function paginate(list) {\r\n            $scope.fullList = list;\r\n            var length = Math.ceil($scope.fullList.length / 10),\r\n                i = 1;\r\n            $scope.pages = Array.apply(null, Array(length)).map(function() { return i++; });\r\n            $scope.list = $scope.fullList.slice(0,11);\r\n\r\n            console.log($scope.list);\r\n        }\r\n    });","angular.module('admin')\r\n\r\n    .controller('PhotoController', function($rootScope, $scope, growl, Photo) {\r\n        console.log('PhotoController');\r\n        /*console.log($scope.photo);*/\r\n        $scope.photoChanged = false;\r\n\r\n        $scope.choosePhoto = function choosePhoto(path) {\r\n            $rootScope.$emit('photoSelected', path);\r\n        };\r\n\r\n        $scope.savePhoto = function savePhoto() {\r\n            Photo.update({id:$scope.photo.id}, {photo: $scope.photo},\r\n                function(res) {\r\n                    growl.addSuccessMessage('Фото сохранено', {ttl: 2000});\r\n                    $scope.photoChanged = false;\r\n                }, function(res) {\r\n                    growl.addErrorMessage('Произошла ошибка', {ttl: 2000});\r\n                });\r\n        };\r\n\r\n        $scope.deletePhoto = function savePhoto($index) {\r\n            Photo.delete({id:$scope.photo.id}, function(res) {\r\n                growl.addSuccessMessage('Фото удалено', {ttl: 2000});\r\n                $scope.list.splice($index, 1);\r\n            }, function(res) {\r\n                growl.addErrorMessage('Произошла ошибка', {ttl: 2000});\r\n            });\r\n        };\r\n\r\n        $scope.$watch(function() {\r\n            return $scope.photo;\r\n        }, checkPhoto, true);\r\n\r\n        function checkPhoto(next, prev) {\r\n            if(next !== prev) {\r\n                $scope.photoChanged = true;\r\n            }\r\n        }\r\n    });","angular.module('admin')\r\n    .factory('Photo', function($resource) {\r\n        return $resource('/api/photo/:id.json', null, {\r\n            update: {\r\n                method: 'PUT'\r\n            }\r\n        });\r\n    });","angular.module('admin')\r\n\r\n    .controller('PhotosController', function($rootScope, $scope, $http, $routeParams, $timeout, growl, Upload, Photo) {\r\n        console.log('PhotosController');\r\n\r\n        $scope.fullList = [];\r\n\r\n        $scope.pages = [];\r\n\r\n        $scope.init = function init(rubric) {\r\n            \r\n            Photo.query({rubric: rubric}, function(list) {\r\n                paginate(list);\r\n            });\r\n        };\r\n\r\n        $scope.changePage = function changePage(page) {\r\n            if(page === 1) {\r\n\r\n                $scope.list = $scope.fullList.slice(0, 11);\r\n            } else {\r\n\r\n                var tok = page * 10,\r\n                    from = tok - 10 + 1,\r\n                    to = tok + 1;\r\n                $scope.list = $scope.fullList.slice(from, to);\r\n            }\r\n        };\r\n\r\n        $scope.clearPhoto = function clearPhoto() {\r\n            \r\n            $scope.photo = {};\r\n            $scope.photoFile = '';\r\n            $scope.imgClass = 'img-uploader__img';\r\n            $scope.photoChanged = false;\r\n        };\r\n\r\n        $scope.selectPhoto = function selectPhoto(photoFile) {\r\n            $scope.photoFile = photoFile;\r\n            $scope.imgClass = 'img-uploader__img_show';\r\n            $scope.progressWidth = {width: 0};\r\n        };\r\n\r\n        $scope.clearPhoto();\r\n\r\n        if($routeParams.rubric) {\r\n            $scope.rubric = $routeParams.rubric;\r\n        }\r\n\r\n        $scope.list = {};\r\n\r\n        $scope.photoRubrics = [\r\n            {\r\n                name: 'Свои',\r\n                value: 'self'\r\n            },\r\n            {\r\n                name: 'Другие',\r\n                value: 'other'\r\n            },\r\n            {\r\n                name: 'Клуб',\r\n                value: 'photos'\r\n            },\r\n            {\r\n                name: 'Материалы',\r\n                value: 'material'\r\n            },\r\n\r\n        ];\r\n\r\n        $scope.list = Photo.query({rubric: $scope.rubric}, function(list) {\r\n            /*console.log(list);*/\r\n            paginate(list);\r\n        });\r\n\r\n        function paginate(list) {\r\n            $scope.fullList = list;\r\n            var length = Math.ceil($scope.fullList.length / 10),\r\n                i = 1;\r\n            $scope.pages = Array.apply(null, Array(length)).map(function() { return i++; });\r\n            $scope.list = $scope.fullList.slice(0,11);\r\n        }\r\n\r\n        $scope.$watch(function() {\r\n            return $scope.photo;\r\n        }, checkPhoto, true);\r\n\r\n        function checkPhoto(next, prev) {\r\n            if(next !== prev) {\r\n                //$scope.imgClass = 'img-uploader__img_show';\r\n                $scope.photoChanged = true;\r\n            }\r\n        }\r\n\r\n        //$scope.photo.test = true;\r\n\r\n        $scope.log = '';\r\n\r\n        $scope.savePhoto = function () {\r\n\r\n            console.log($scope.photoFile);\r\n\r\n            if (!$scope.photoFile.$error) {\r\n\r\n                var photo = $scope.photo;\r\n                photo.file = $scope.photoFile;\r\n                $scope.clearPhoto();\r\n\r\n                Upload.upload({\r\n                    url: '/api/photo/',\r\n                    data: {\r\n                        photo: photo\r\n                    }\r\n                }).then(function (resp) {\r\n                \r\n                    $scope.list.unshift(resp.data);\r\n                    growl.addSuccessMessage('Фото добавлено', {ttl: 2000});\r\n                }, function (resp) {\r\n                    growl.addErrorMessage('Произошла ошибка', {ttl: 2000});\r\n                }, function (evt) {\r\n                    var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\r\n                    $scope.progressWidth = {width: progressPercentage + '% '};\r\n                    console.log('progress: ' + progressPercentage + '% ');\r\n                });\r\n            }\r\n        };\r\n    });","angular.module('admin')\r\n\r\n    .controller('PhotosWindowController', function($rootScope, $scope, $modalInstance) {\r\n        $scope.closeWindow = function closeWindow() {\r\n            $modalInstance.dismiss('cancel');\r\n        };\r\n\r\n        $rootScope.$on('photoSelected', function(e, path) {\r\n            $modalInstance.close(path);\r\n        });\r\n    });","angular.module('admin')\r\n\r\n    .controller('TagController', function($scope) {\r\n        console.log('TagController');\r\n    });","angular.module('admin')\r\n\r\n    .controller('TagsController', function($scope) {\r\n        console.log('TagsController');\r\n    });","angular.module('admin')\r\n    .factory('Video', function($resource) {\r\n        return $resource('/api/video/:id.json', null, {\r\n            update: {\r\n                method: 'PUT'\r\n            }\r\n        });\r\n    });","angular.module('admin')\r\n\r\n    .controller('VideoController', function($rootScope, $scope, $http, $routeParams, $timeout, Video) {\r\n        console.log('VideoController');\r\n                /*console.log($scope.video);*/\r\n        $scope.videoChanged = false;\r\n\r\n        $scope.saveVideo = function saveVideo() {\r\n            Video.update({id:$scope.video.id}, {video: $scope.video});\r\n            $scope.videoChanged = false;\r\n        };\r\n\r\n        $scope.deleteVideo = function saveVideo($index) {\r\n            Video.delete({id:$scope.video.id});\r\n            $scope.list.splice($index, 1);\r\n        };\r\n\r\n        $scope.$watch(function() {\r\n            return $scope.video;\r\n        }, checkVideo, true);\r\n\r\n        function checkVideo(next, prev) {\r\n            if(next !== prev) {\r\n                $scope.videoChanged = true;\r\n            }\r\n        }\r\n    });","angular.module('admin')\r\n\r\n    .controller('VideosController', function($rootScope, $scope, $http, $routeParams, $timeout, Video) {\r\n       console.log('VideosController');\r\n\r\n        $scope.fullList = [];\r\n\r\n        $scope.pages = [];\r\n\r\n        $scope.changePage = function changePage(page) {\r\n            if(page === 1) {\r\n\r\n                $scope.list = $scope.fullList.slice(0, 11);\r\n            } else {\r\n\r\n                var tok = page * 10,\r\n                    from = tok - 10 + 1,\r\n                    to = tok + 1;\r\n                $scope.list = $scope.fullList.slice(from, to);\r\n            }\r\n        };\r\n\r\n        if($routeParams.rubric) {\r\n            $scope.rubric = $routeParams.rubric;\r\n        }\r\n\r\n        $scope.clearVideo = function() {\r\n            $scope.video = {};\r\n        };\r\n\r\n        $scope.clearVideo();\r\n\r\n        $scope.list = {};\r\n\r\n        $scope.videoRubrics = [\r\n            {\r\n                name: 'Свои',\r\n                value: 'self'\r\n            },\r\n            {\r\n                name: 'Другие',\r\n                value: 'other'\r\n            },\r\n\r\n        ];\r\n\r\n\r\n        Video.query({rubric: $scope.rubric}, function(list) {\r\n            paginate(list);\r\n        });\r\n\r\n        function paginate(list) {\r\n            $scope.fullList = list;\r\n            var length = Math.ceil($scope.fullList.length / 10),\r\n                i = 1;\r\n            $scope.pages = Array.apply(null, Array(length)).map(function() { return i++; });\r\n            $scope.list = $scope.fullList.slice(0,11);\r\n        }\r\n\r\n        $scope.$watch(function() {\r\n            return $scope.video;\r\n        }, checkVideo, true);\r\n\r\n        function checkVideo(next, prev) {\r\n            if(next !== prev) {\r\n                //$scope.imgClass = 'img-uploader__img_show';\r\n                $scope.videoChanged = true;\r\n            }\r\n        }\r\n\r\n        //$scope.video.test = true;\r\n\r\n        $scope.log = '';\r\n\r\n        $scope.saveVideo = function () {\r\n            var video = $scope.video;\r\n            Video.save({video: video}, function(video) {\r\n                $scope.list.unshift(video);\r\n            });\r\n        };\r\n    });"],"sourceRoot":"/source/"}