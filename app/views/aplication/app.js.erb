console.log("Starting app"),$("#menu-toggle").click(function(o){o.preventDefault(),$("#wrapper").toggleClass("toggled")}),angular.module("admin",["ngRoute","ngSanitize","ngResource","textAngular","ui.bootstrap","ngFileUpload"]).config(["$routeProvider","$locationProvider","$provide",function(o,e,t){t.decorator("taOptions",["taRegisterTool","$modal","$delegate",function(o,e,t){return t.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol"],["undo","redo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["insertLink","insertVideo","html"]],o("imageUpload",{iconclass:"fa fa-picture-o",action:function(o){var t=this,l=rangy.saveSelection(),r=e.open({animation:!0,templateUrl:"/api/photo/overlay.html",size:"lg",controller:"PhotosWindowController"});return r.result.then(function(e){rangy.restoreSelection(l),t.$editor().wrapSelection("insertImage","/img/photos/"+e),o.resolve()}),!1}}),t.toolbar[4].unshift("imageUpload"),t}]),o.when("/",{templateUrl:"/api/material/list.html",controller:"MaterialsController",controllerAs:"materials"}).when("/materials/:rubric",{templateUrl:"/api/material/list.html",controller:"MaterialsController"}).when("/materials",{templateUrl:"/api/material/list.html",controller:"MaterialsController"}).when("/material/:id",{templateUrl:"/api/material/edit.html",controller:"MaterialController"}).when("/photos",{templateUrl:"/api/photo/list.html",controller:"PhotosController"}).when("/photos/:rubric",{templateUrl:"/api/photo/list.html",controller:"PhotosController"}).when("/videos",{templateUrl:"/api/video/list.html",controller:"VideosController",controllerAs:"videos"}).when("/videos/:rubric",{templateUrl:"/api/video/list.html",controller:"VideosController",controllerAs:"videos"}).when("/tags",{templateUrl:"/api/tag/list.html",controller:"TagsController",controllerAs:"tags"}).when("/tags/:id",{templateUrl:"/api/tag/edit.html",controller:"TagController",controllerAs:"tag"}),e.html5Mode(!0)}]),angular.module("admin").factory("Material",["$resource",function(o){return o("/api/material/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("MaterialController",["$scope","$routeParams","$location","$log","Material",function(o,e,t,l,r){l.info("MaterialController"),o.showPhotosWindow=!1,o.selectedTags=[];var a={};o.file="",isNaN(parseFloat(e.id))||(a=r.get({id:e.id},function(e){e.material.published=new Date(e.material.published),o.selectedTags=e.tags,o.material=e.material})),o.saveMaterial=function(){var e=o.material;"persons"===e.rubric?e.tags=o.selectedTags:o.selectedTags=[],o.material.id?r.update({id:o.material.id},{material:e},function(e){e.published=new Date(e.published),o.material=e}):r.save({material:e},function(e){e.published=new Date(e.published),o.material=e,t.path("/material/"+e.id)})},o.materialRubrics=[{name:"Персоны",value:"persons"},{name:"Рецензии",value:"reviews"},{name:"Путешечтвия",value:"travel"},{name:"Новости Клуба",value:"news"},{name:"Стихи",value:"poetry"},{name:"Песни",value:"songs"},{name:"Рассказы",value:"stories"},{name:"Мысли",value:"thoughts"}],o.materialTags=[{id:1,name:"Звёзды",alias:"celebrity"},{id:2,name:"Актёры",alias:"actors"},{id:3,name:"Режисёры",alias:"Directors"}]}]),angular.module("admin").controller("MaterialsController",["$scope","$routeParams","Material",function(o,e,t){console.log("MaterialsController");var l=e.rubric;o.list=t.query({rubric:l},function(o){console.log(o)})}]),angular.module("admin").controller("PhotoController",["$rootScope","$scope","Photo",function(o,e,t){function l(o,t){o!==t&&(e.photoChanged=!0)}console.log("PhotoController"),e.photoChanged=!1,e.choosePhoto=function(e){o.$emit("photoSelected",e)},e.savePhoto=function(){t.update({id:e.photo.id},{photo:e.photo}),e.photoChanged=!1},e.deletePhoto=function(o){t["delete"]({id:e.photo.id}),e.list.splice(o,1)},e.$watch(function(){return e.photo},l,!0)}]),angular.module("admin").factory("Photo",["$resource",function(o){return o("/api/photo/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("PhotosController",["$rootScope","$scope","$http","$routeParams","$timeout","Upload","Photo",function(o,e,t,l,r,a,i){function n(o,t){o!==t&&(e.photoChanged=!0)}console.log("PhotosController"),e.clearPhoto=function(){e.photo={},e.photoFile="",e.imgClass="img-uploader__img",e.photoChanged=!1},e.selectPhoto=function(o){e.photoFile=o,e.imgClass="img-uploader__img_show",e.progressWidth={width:0}},e.clearPhoto(),l.rubric&&(e.rubric=l.rubric),e.list={},e.photoRubrics=[{name:"Свои",value:"self"},{name:"Другие",value:"other"},{name:"Клуб",value:"photos"},{name:"Материалы",value:"material"}],e.list=i.query({rubric:e.rubric},function(){}),e.$watch(function(){return e.photo},n,!0),e.log="",e.savePhoto=function(){if(console.log(e.photoFile),!e.photoFile.$error){var o=e.photo;o.file=e.photoFile,e.clearPhoto(),a.upload({url:"/api/photo/",data:{photo:o}}).progress(function(o){var t=parseInt(100*o.loaded/o.total);e.progressWidth={width:t+"% "},console.log("progress: "+t+"% ")}).success(function(o){e.list.unshift(o)})}}}]),angular.module("admin").controller("PhotosWindowController",["$rootScope","$scope","$modalInstance",function(o,e,t){e.closeWindow=function(){t.dismiss("cancel")},o.$on("photoSelected",function(o,e){t.close(e)})}]),angular.module("admin").controller("TagController",["$scope",function(){console.log("TagController")}]),angular.module("admin").controller("TagsController",["$scope",function(){console.log("TagsController")}]),angular.module("admin").factory("Video",["$resource",function(o){return o("/api/video/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("VideoController",["$rootScope","$scope","$http","$routeParams","$timeout","Video",function(o,e,t,l,r,a){function i(o,t){o!==t&&(e.videoChanged=!0)}console.log("VideoController"),e.videoChanged=!1,e.saveVideo=function(){a.update({id:e.video.id},{video:e.video}),e.videoChanged=!1},e.deleteVideo=function(o){a["delete"]({id:e.video.id}),e.list.splice(o,1)},e.$watch(function(){return e.video},i,!0)}]),angular.module("admin").controller("VideosController",["$rootScope","$scope","$http","$routeParams","$timeout","Video",function(o,e,t,l,r,a){function i(o,t){o!==t&&(e.videoChanged=!0)}console.log("VideosController"),l.rubric&&(e.rubric=l.rubric),e.clearVideo=function(){e.video={}},e.clearVideo(),e.list={},e.videoRubrics=[{name:"Свои",value:"self"},{name:"Другие",value:"other"}],e.list=a.query({rubric:e.rubric},function(){}),e.$watch(function(){return e.video},i,!0),e.log="",e.saveVideo=function(){var o=e.video;a.save({video:o},function(o){e.list.unshift(o)})}}]);