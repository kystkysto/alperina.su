console.log("Starting app"),$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")}),angular.module("admin",["ngRoute","ngSanitize","ngResource","textAngular","ui.bootstrap","ngFileUpload","angular-growl"]).config(["$routeProvider","$locationProvider","$provide",function(e,t,o){o.decorator("taOptions",["taRegisterTool","$modal","$delegate",function(e,t,o){return o.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol"],["undo","redo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["insertLink","insertVideo","html"]],e("imageUpload",{iconclass:"fa fa-picture-o",action:function(e){var o=this,l=rangy.saveSelection(),a=t.open({animation:!0,templateUrl:"/api/photo/overlay.html",size:"lg",controller:"PhotosWindowController"});return a.result.then(function(t){rangy.restoreSelection(l),o.$editor().wrapSelection("insertImage","/img/photos/"+t),e.resolve()}),!1}}),o.toolbar[4].unshift("imageUpload"),o}]),e.when("/",{templateUrl:"/api/material/list.html",controller:"MaterialsController",controllerAs:"materials"}).when("/materials/:rubric",{templateUrl:"/api/material/list.html",controller:"MaterialsController"}).when("/materials",{templateUrl:"/api/material/list.html",controller:"MaterialsController"}).when("/material/:id",{templateUrl:"/api/material/edit.html",controller:"MaterialController"}).when("/photos",{templateUrl:"/api/photo/list.html",controller:"PhotosController"}).when("/photos/:rubric",{templateUrl:"/api/photo/list.html",controller:"PhotosController"}).when("/videos",{templateUrl:"/api/video/list.html",controller:"VideosController",controllerAs:"videos"}).when("/videos/:rubric",{templateUrl:"/api/video/list.html",controller:"VideosController",controllerAs:"videos"}).when("/tags",{templateUrl:"/api/tag/list.html",controller:"TagsController",controllerAs:"tags"}).when("/tags/:id",{templateUrl:"/api/tag/edit.html",controller:"TagController",controllerAs:"tag"}),t.html5Mode(!0)}]),angular.module("admin").factory("Material",["$resource",function(e){return e("/api/material/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").directive("csDateToIso",function(){var e=function(e,t,o,l){l.$parsers.push(function(e){return moment(e).format("YYYY-MM-DD")})};return{restrict:"A",require:"ngModel",link:e}}).controller("MaterialController",["$scope","$routeParams","$location","$log","growl","Material",function(e,t,o,l,a,r){e.material={},l.info("MaterialController"),e.showPhotosWindow=!1,e.selectedTags=[];var i={};e.file="",isNaN(parseFloat(t.id))?e.material.published=new Date:i=r.get({id:t.id},function(t){t.material.published=new Date(t.material.published),e.selectedTags=t.tags,e.material=t.material}),e.deleteMaterial=function(){r["delete"]({id:e.material.id},function(){a.addSuccessMessage("Материал удалён",{ttl:2e3}),e.material.id=null,setTimeout(function(){o.path("/materials")},1e3)},function(){a.addErrorMessage("Ошибка при удалении",{ttl:2e3})})},e.saveMaterial=function(){var t=e.material;"persons"===t.rubric?t.tags=e.selectedTags:e.selectedTags=[],e.material.id?r.update({id:e.material.id},{material:t},function(t){t.published=new Date(t.published),e.material=t,a.addSuccessMessage("Материал сохранён",{ttl:2e3})},function(){a.addErrorMessage("Произошла ошибка",{ttl:2e3})}):r.save({material:t},function(t){t.published=new Date(t.published),e.material=t,o.path("/material/"+t.id),a.addSuccessMessage("Материал добавлен",{ttl:2e3})},function(){a.addErrorMessage("Произошла ошибка",{ttl:2e3})})},e.materialRubrics=[{name:"Персоны",value:"persons"},{name:"Рецензии",value:"reviews"},{name:"Путешечтвия",value:"travel"},{name:"Новости Клуба",value:"news"},{name:"Стихи",value:"poetry"},{name:"Песни",value:"songs"},{name:"Рассказы",value:"stories"},{name:"Мысли",value:"thoughts"}],e.materialTags=[{id:1,name:"Звёзды",created_at:"2015-09-27T10:00:25.642Z",updated_at:"2015-09-28T19:59:55.681Z",alias:"celebrity"},{id:2,name:"Режисеры",created_at:"2015-10-04T17:19:17.065Z",updated_at:"2015-10-04T17:19:17.065Z",alias:"directors"},{id:3,name:"Актёры",created_at:"2015-10-04T17:19:35.249Z",updated_at:"2015-10-04T17:19:35.249Z",alias:"actors"},{id:4,name:"Продюсеры",created_at:"2015-10-04T17:20:21.887Z",updated_at:"2015-10-04T17:20:21.887Z",alias:"producers"},{id:5,name:"Писатели",created_at:"2015-10-04T17:20:35.006Z",updated_at:"2015-10-04T17:20:35.006Z",alias:"writers"},{id:6,name:"Шоу-бизнес",created_at:"2015-10-04T17:20:51.705Z",updated_at:"2015-10-04T17:20:51.705Z",alias:"show_business"}]}]),angular.module("admin").controller("MaterialsController",["$scope","$routeParams","Material",function(e,t,o){function l(t){e.fullList=t;var o=Math.ceil(e.fullList.length/10),l=1;e.pages=Array.apply(null,Array(o)).map(function(){return l++}),e.list=e.fullList.slice(0,11),console.log(e.list)}console.log("MaterialsController");var a=t.rubric;e.fullList=[],e.pages=[],e.changePage=function(t){if(1===t)e.list=e.fullList.slice(0,11);else{var o=10*t,l=o-10+1,a=o+1;e.list=e.fullList.slice(l,a)}},o.query({rubric:a,after:"infinity"},function(e){l(e)})}]),angular.module("admin").controller("PhotoController",["$rootScope","$scope","growl","Photo",function(e,t,o,l){function a(e,o){e!==o&&(t.photoChanged=!0)}console.log("PhotoController"),t.photoChanged=!1,t.choosePhoto=function(t){e.$emit("photoSelected",t)},t.savePhoto=function(){l.update({id:t.photo.id},{photo:t.photo},function(){o.addSuccessMessage("Фото сохранено",{ttl:2e3}),t.photoChanged=!1},function(){o.addErrorMessage("Произошла ошибка",{ttl:2e3})})},t.deletePhoto=function(e){l["delete"]({id:t.photo.id},function(){o.addSuccessMessage("Фото удалено",{ttl:2e3}),t.list.splice(e,1)},function(){o.addErrorMessage("Произошла ошибка",{ttl:2e3})})},t.$watch(function(){return t.photo},a,!0)}]),angular.module("admin").factory("Photo",["$resource",function(e){return e("/api/photo/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("PhotosController",["$rootScope","$scope","$http","$routeParams","$timeout","growl","Upload","Photo",function(e,t,o,l,a,r,i,n){function s(e){t.fullList=e;var o=Math.ceil(t.fullList.length/10),l=1;t.pages=Array.apply(null,Array(o)).map(function(){return l++}),t.list=t.fullList.slice(0,11)}function u(e,o){e!==o&&(t.photoChanged=!0)}console.log("PhotosController"),t.fullList=[],t.pages=[],t.init=function(e){n.query({rubric:e},function(e){s(e)})},t.changeRubric=function(e){t.init(e)},t.changePage=function(e){if(1===e)t.list=t.fullList.slice(0,11);else{var o=10*e,l=o-10+1,a=o+1;t.list=t.fullList.slice(l,a)}},t.clearPhoto=function(){t.photo={},t.photoFile="",t.imgClass="img-uploader__img",t.photoChanged=!1},t.selectPhoto=function(e){t.photoFile=e,t.imgClass="img-uploader__img_show",t.progressWidth={width:0}},t.clearPhoto(),l.rubric&&(t.rubric=l.rubric),t.list={},t.photoRubrics=[{name:"Свои",value:"self"},{name:"Другие",value:"other"},{name:"Клуб",value:"photos"},{name:"Материалы",value:"material"}],t.list=n.query({rubric:t.rubric},function(e){s(e)}),t.$watch(function(){return t.photo},u,!0),t.log="",t.savePhoto=function(){if(console.log(t.photoFile),!t.photoFile.$error){var e=t.photo;e.file=t.photoFile,t.clearPhoto(),i.upload({url:"/api/photo/",data:{photo:e}}).then(function(e){t.list.unshift(e.data),r.addSuccessMessage("Фото добавлено",{ttl:2e3})},function(){r.addErrorMessage("Произошла ошибка",{ttl:2e3})},function(e){var o=parseInt(100*e.loaded/e.total);t.progressWidth={width:o+"% "},console.log("progress: "+o+"% ")})}}}]),angular.module("admin").controller("PhotosWindowController",["$rootScope","$scope","$modalInstance",function(e,t,o){t.closeWindow=function(){o.dismiss("cancel")},e.$on("photoSelected",function(e,t){o.close(t)})}]),angular.module("admin").controller("TagController",["$scope",function(){console.log("TagController")}]),angular.module("admin").controller("TagsController",["$scope",function(){console.log("TagsController")}]),angular.module("admin").factory("Video",["$resource",function(e){return e("/api/video/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("VideoController",["$rootScope","$scope","$http","$routeParams","$timeout","Video",function(e,t,o,l,a,r){function i(e,o){e!==o&&(t.videoChanged=!0)}console.log("VideoController"),t.videoChanged=!1,t.saveVideo=function(){r.update({id:t.video.id},{video:t.video}),t.videoChanged=!1},t.deleteVideo=function(e){r["delete"]({id:t.video.id}),t.list.splice(e,1)},t.$watch(function(){return t.video},i,!0)}]),angular.module("admin").controller("VideosController",["$rootScope","$scope","$http","$routeParams","$timeout","Video",function(e,t,o,l,a,r){function i(e){t.fullList=e;var o=Math.ceil(t.fullList.length/10),l=1;t.pages=Array.apply(null,Array(o)).map(function(){return l++}),t.list=t.fullList.slice(0,11)}function n(e,o){e!==o&&(t.videoChanged=!0)}console.log("VideosController"),t.fullList=[],t.pages=[],t.changePage=function(e){if(1===e)t.list=t.fullList.slice(0,11);else{var o=10*e,l=o-10+1,a=o+1;t.list=t.fullList.slice(l,a)}},l.rubric&&(t.rubric=l.rubric),t.clearVideo=function(){t.video={}},t.clearVideo(),t.list={},t.videoRubrics=[{name:"САНолюбование",value:"self"},{name:"КлипС.А.",value:"other"},{name:"Клуб одесситов",value:"club"}],r.query({rubric:t.rubric},function(e){i(e)}),t.$watch(function(){return t.video},n,!0),t.log="",t.saveVideo=function(){var e=t.video;r.save({video:e},function(e){t.list.unshift(e)})}}]);