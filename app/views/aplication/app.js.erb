console.log("Starting app"),$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")}),angular.module("admin",["ngRoute","ngSanitize","ngResource","textAngular","ui.bootstrap","ngFileUpload","angular-growl"]).config(["$routeProvider","$locationProvider","$provide",function(e,o,t){t.decorator("taOptions",["taRegisterTool","$modal","$delegate",function(e,o,t){return t.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol"],["undo","redo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["insertLink","insertVideo","html"]],e("imageUpload",{iconclass:"fa fa-picture-o",action:function(e){var t=this,l=rangy.saveSelection(),r=o.open({animation:!0,templateUrl:"/api/photo/overlay.html",size:"lg",controller:"PhotosWindowController"});return r.result.then(function(o){rangy.restoreSelection(l),t.$editor().wrapSelection("insertImage","/img/photos/"+o),e.resolve()}),!1}}),t.toolbar[4].unshift("imageUpload"),t}]),e.when("/",{templateUrl:"/api/material/list.html",controller:"MaterialsController",controllerAs:"materials"}).when("/materials/:rubric",{templateUrl:"/api/material/list.html",controller:"MaterialsController"}).when("/materials",{templateUrl:"/api/material/list.html",controller:"MaterialsController"}).when("/material/:id",{templateUrl:"/api/material/edit.html",controller:"MaterialController"}).when("/photos",{templateUrl:"/api/photo/list.html",controller:"PhotosController"}).when("/photos/:rubric",{templateUrl:"/api/photo/list.html",controller:"PhotosController"}).when("/videos",{templateUrl:"/api/video/list.html",controller:"VideosController",controllerAs:"videos"}).when("/videos/:rubric",{templateUrl:"/api/video/list.html",controller:"VideosController",controllerAs:"videos"}).when("/tags",{templateUrl:"/api/tag/list.html",controller:"TagsController",controllerAs:"tags"}).when("/tags/:id",{templateUrl:"/api/tag/edit.html",controller:"TagController",controllerAs:"tag"}),o.html5Mode(!0)}]),angular.module("admin").factory("Material",["$resource",function(e){return e("/api/material/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("MaterialController",["$scope","$routeParams","$location","$log","growl","Material",function(e,o,t,l,r,i){l.info("MaterialController"),e.showPhotosWindow=!1,e.selectedTags=[];var a={};e.file="",isNaN(parseFloat(o.id))||(a=i.get({id:o.id},function(o){o.material.published=new Date(o.material.published),e.selectedTags=o.tags,e.material=o.material})),e.deleteMaterial=function(){i["delete"]({id:e.material.id},function(){r.addSuccessMessage("Материал удалён",{ttl:2e3}),e.material.id=null,setTimeout(function(){t.path("/admin/materials")},1e3)},function(){r.addErrorMessage("Ошибка при удалении",{ttl:2e3})})},e.saveMaterial=function(){var o=e.material;"persons"===o.rubric?o.tags=e.selectedTags:e.selectedTags=[],e.material.id?i.update({id:e.material.id},{material:o},function(o){o.published=new Date(o.published),e.material=o,r.addSuccessMessage("Материал сохранён",{ttl:2e3})},function(){r.addErrorMessage("Произошла ошибка",{ttl:2e3})}):i.save({material:o},function(o){o.published=new Date(o.published),e.material=o,t.path("/material/"+o.id),r.addSuccessMessage("Материал добавлен",{ttl:2e3})},function(){r.addErrorMessage("Произошла ошибка",{ttl:2e3})})},e.materialRubrics=[{name:"Персоны",value:"persons"},{name:"Рецензии",value:"reviews"},{name:"Путешечтвия",value:"travel"},{name:"Новости Клуба",value:"news"},{name:"Стихи",value:"poetry"},{name:"Песни",value:"songs"},{name:"Рассказы",value:"stories"},{name:"Мысли",value:"thoughts"}],e.materialTags=[{id:1,name:"Звёзды",alias:"celebrity"},{id:2,name:"Актёры",alias:"actors"},{id:3,name:"Режисёры",alias:"Directors"}]}]),angular.module("admin").controller("MaterialsController",["$scope","$routeParams","Material",function(e,o,t){function l(o){e.fullList=o;var t=Math.ceil(e.fullList.length/10),l=1;e.pages=Array.apply(null,Array(t)).map(function(){return l++}),e.list=e.fullList.slice(0,11),console.log(e.list)}console.log("MaterialsController");var r=o.rubric;e.fullList=[],e.pages=[],e.changePage=function(o){if(1===o)e.list=e.fullList.slice(0,11);else{var t=10*o,l=t-10+1,r=t+1;e.list=e.fullList.slice(l,r)}},t.query({rubric:r,after:"infinity"},function(e){l(e)})}]),angular.module("admin").controller("PhotoController",["$rootScope","$scope","growl","Photo",function(e,o,t,l){function r(e,t){e!==t&&(o.photoChanged=!0)}console.log("PhotoController"),o.photoChanged=!1,o.choosePhoto=function(o){e.$emit("photoSelected",o)},o.savePhoto=function(){l.update({id:o.photo.id},{photo:o.photo},function(){t.addSuccessMessage("Фото сохранено",{ttl:2e3}),o.photoChanged=!1},function(){t.addErrorMessage("Произошла ошибка",{ttl:2e3})})},o.deletePhoto=function(e){l["delete"]({id:o.photo.id},function(){t.addSuccessMessage("Фото удалено",{ttl:2e3}),o.list.splice(e,1)},function(){t.addErrorMessage("Произошла ошибка",{ttl:2e3})})},o.$watch(function(){return o.photo},r,!0)}]),angular.module("admin").factory("Photo",["$resource",function(e){return e("/api/photo/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("PhotosController",["$rootScope","$scope","$http","$routeParams","$timeout","growl","Upload","Photo",function(e,o,t,l,r,i,a,n){function s(e){o.fullList=e;var t=Math.ceil(o.fullList.length/10),l=1;o.pages=Array.apply(null,Array(t)).map(function(){return l++}),o.list=o.fullList.slice(0,11)}function u(e,t){e!==t&&(o.photoChanged=!0)}console.log("PhotosController"),o.fullList=[],o.pages=[],o.init=function(e){n.query({rubric:e},function(e){s(e)})},o.changePage=function(e){if(1===e)o.list=o.fullList.slice(0,11);else{var t=10*e,l=t-10+1,r=t+1;o.list=o.fullList.slice(l,r)}},o.clearPhoto=function(){o.photo={},o.photoFile="",o.imgClass="img-uploader__img",o.photoChanged=!1},o.selectPhoto=function(e){o.photoFile=e,o.imgClass="img-uploader__img_show",o.progressWidth={width:0}},o.clearPhoto(),l.rubric&&(o.rubric=l.rubric),o.list={},o.photoRubrics=[{name:"Свои",value:"self"},{name:"Другие",value:"other"},{name:"Клуб",value:"photos"},{name:"Материалы",value:"material"}],o.list=n.query({rubric:o.rubric},function(e){s(e)}),o.$watch(function(){return o.photo},u,!0),o.log="",o.savePhoto=function(){if(console.log(o.photoFile),!o.photoFile.$error){var e=o.photo;e.file=o.photoFile,o.clearPhoto(),a.upload({url:"/api/photo/",data:{photo:e}}).then(function(e){o.list.unshift(e.data),i.addSuccessMessage("Фото добавлено",{ttl:2e3})},function(){i.addErrorMessage("Произошла ошибка",{ttl:2e3})},function(e){var t=parseInt(100*e.loaded/e.total);o.progressWidth={width:t+"% "},console.log("progress: "+t+"% ")})}}}]),angular.module("admin").controller("PhotosWindowController",["$rootScope","$scope","$modalInstance",function(e,o,t){o.closeWindow=function(){t.dismiss("cancel")},e.$on("photoSelected",function(e,o){t.close(o)})}]),angular.module("admin").controller("TagController",["$scope",function(){console.log("TagController")}]),angular.module("admin").controller("TagsController",["$scope",function(){console.log("TagsController")}]),angular.module("admin").factory("Video",["$resource",function(e){return e("/api/video/:id.json",null,{update:{method:"PUT"}})}]),angular.module("admin").controller("VideoController",["$rootScope","$scope","$http","$routeParams","$timeout","Video",function(e,o,t,l,r,i){function a(e,t){e!==t&&(o.videoChanged=!0)}console.log("VideoController"),o.videoChanged=!1,o.saveVideo=function(){i.update({id:o.video.id},{video:o.video}),o.videoChanged=!1},o.deleteVideo=function(e){i["delete"]({id:o.video.id}),o.list.splice(e,1)},o.$watch(function(){return o.video},a,!0)}]),angular.module("admin").controller("VideosController",["$rootScope","$scope","$http","$routeParams","$timeout","Video",function(e,o,t,l,r,i){function a(e){o.fullList=e;var t=Math.ceil(o.fullList.length/10),l=1;o.pages=Array.apply(null,Array(t)).map(function(){return l++}),o.list=o.fullList.slice(0,11)}function n(e,t){e!==t&&(o.videoChanged=!0)}console.log("VideosController"),o.fullList=[],o.pages=[],o.changePage=function(e){if(1===e)o.list=o.fullList.slice(0,11);else{var t=10*e,l=t-10+1,r=t+1;o.list=o.fullList.slice(l,r)}},l.rubric&&(o.rubric=l.rubric),o.clearVideo=function(){o.video={}},o.clearVideo(),o.list={},o.videoRubrics=[{name:"Свои",value:"self"},{name:"Другие",value:"other"}],i.query({rubric:o.rubric},function(e){a(e)}),o.$watch(function(){return o.video},n,!0),o.log="",o.saveVideo=function(){var e=o.video;i.save({video:e},function(e){o.list.unshift(e)})}}]);